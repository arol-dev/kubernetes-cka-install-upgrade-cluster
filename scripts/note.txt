# Add comands in node1 and node2 at start

sudo su
chmod +x common.sh
./common.sh

# After Join in the Nodes1

- remeber that the kubectl get nodes works only on the controlplane, is missing the admin.config in nodes machine
- Move to your visualstudio, prerequisite kubectl install
- create a new KUBECONFIG file with the content of admin.config file from master-node from VirtualBox
- define KUBECONFIG=... al path del file creato prima
- kubectl config get-contexts #to check the contexts
- kubectl config use-context kubernetes-admin@kubernetes # to swith to the new cluster
- k get nodes # to start talking with the API-Server in the VirtualBox master-node
- k create ns bookinfo
- kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.23/samples/bookinfo/platform/kube/bookinfo.yaml -n bookinfo
- kubectl port-forward svc/productpage 9080:9080 -n bookinfo

# Test from Browser
- http://127.0.0.1:9080/productpage

# Test from master-node
kubectl exec ratings-v1-7c9bd4b87f-wh4cj -n bookinfo -c ratings -- curl -sS productpage.bookinfo:9080/productpage

# Fix coredns
kubectl -n kube-system rollout restart deployment coredns